<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Mi Macita Hermosa üë∏ ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

        :root {
            --primary: #7c3aed; 
            --secondary: #a78bfa;
            --bg-gradient: linear-gradient(135deg, #f5f3ff 0%, #ddd6fe 100%);
            --card-bg: #2e1065;
            --card-text: #ffffff;
            --hinge-color: linear-gradient(to right, #94a3b8, #475569, #94a3b8);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-gradient);
            /* FIX M√ìVIL 1: dvh asegura que el fondo ocupe el 100% real sin cortes */
            height: 100dvh;
            margin: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .font-romantic { font-family: 'Dancing Script', cursive; }

        .particle, .photo-particle {
            position: absolute;
            pointer-events: none;
            animation: floatUp linear forwards;
        }

        /* FIX M√ìVIL 2: Z-index muy alto para que las fotos no se escondan tras el modal */
        .photo-particle {
            background: white;
            padding: 6px;
            padding-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            border-radius: 4px;
            z-index: 9999; 
            border: 1px solid #eee;
        }

        @keyframes floatUp {
            0% { transform: translateY(110vh) scale(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-30vh) scale(1.1) rotate(360deg); opacity: 0; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(167, 139, 250, 0.4);
            box-shadow: 0 25px 50px -12px rgba(124, 58, 237, 0.25);
            /* FIX M√ìVIL 3: max-height din√°mico para que no se salga de la pantalla */
            max-height: 94dvh;
            width: 92%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 10;
        }

        /* --- RELOJ FLIP --- */
        .flip-card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .flip-unit {
            position: relative;
            width: 100%;
            max-width: 58px;
            height: 60px; 
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.5);
        }

        .half {
            position: absolute;
            left: 0;
            width: 100%;
            height: 50%;
            overflow: hidden;
            background: var(--card-bg);
            display: flex;
            justify-content: center;
            backface-visibility: hidden;
        }

        .top {
            top: 0;
            border-radius: 8px 8px 0 0;
            align-items: flex-start;
            border-bottom: 1px solid rgba(0,0,0,0.4);
        }

        .bottom {
            bottom: 0;
            border-radius: 0 0 8px 8px;
            align-items: flex-end;
        }

        .num {
            font-size: 2.1rem;
            font-weight: 800;
            color: var(--card-text);
            line-height: 60px; 
            height: 60px;
            position: absolute;
        }

        .top .num { top: 0; }
        .bottom .num { bottom: 0; }

        .leaf {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            z-index: 50;
            transform-origin: bottom;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .leaf-front, .leaf-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            background: var(--card-bg);
        }

        .leaf-front {
            border-radius: 8px 8px 0 0;
            align-items: flex-start;
            border-bottom: 1px solid rgba(0,0,0,0.4);
        }

        .leaf-back {
            transform: rotateX(-180deg);
            border-radius: 0 0 8px 8px;
            align-items: flex-end;
        }

        .leaf-front .num { top: 0; }
        .leaf-back .num { bottom: 0; }

        .leaf.flipping { transform: rotateX(-180deg); }

        .hinge {
            position: absolute;
            top: 50%;
            width: 3px;
            height: 14px;
            background: var(--hinge-color);
            transform: translateY(-50%);
            z-index: 100;
            border-radius: 1px;
        }
        .hinge-left { left: 6px; }
        .hinge-right { right: 6px; }

        .flip-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            font-weight: 800;
            color: #7c3aed;
            margin-top: 6px;
            letter-spacing: 0.1em;
        }

        .btn-clock-style {
            background: var(--card-bg);
            color: var(--card-text);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.4);
            border-radius: 14px;
            font-weight: 800;
            transition: all 0.3s ease;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-clock-style:active { transform: scale(0.96); }

        .pulse-btn { animation: pulse-violet 2s infinite; }
        @keyframes pulse-violet {
            0% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.6); }
            70% { box-shadow: 0 0 0 12px rgba(124, 58, 237, 0); }
            100% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0); }
        }

        #btnNo { z-index: 50; will-change: transform; }

        /* FIX M√ìVIL 4: Capa base separada para que nada bloquee las fotos */
        #photo-layer {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
        }

        /* --- EFECTO TRANSICI√ìN REGALO --- */
        .gift-container-animate {
            position: fixed !important;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(10);
            z-index: 5000;
            transition: all 2.0s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }

        .gift-explode {
            animation: explode 1.2s forwards;
        }

        @keyframes explode {
            0% { transform: translate(-50%, -50%) scale(10); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(25); opacity: 0; }
        }
      
    </style>
</head>
<body>

    <!-- FIX M√ìVIL 5: Preload asegura que el audio est√© listo para dispararse -->
    <audio id="background-music" preload="auto" loop></audio>

    <div id="photo-layer"></div>
    <div id="particles-container" class="fixed inset-0 pointer-events-none"></div>

    <main class="relative z-10 w-full max-w-md px-4 flex justify-center">
        <div class="glass-card rounded-[40px] p-6 text-center relative overflow-hidden">
            
            <div class="flex justify-center shrink-0">
                <!-- ID A√ëADIDO: gift-wrapper -->
                <div id="gift-wrapper" class="relative transition-all duration-700">
                    <span id="gift-emoji" class="text-4xl animate-bounce inline-block">üéÅ</span>
                    <div id="gift-badge" class="absolute -top-1 -right-1 bg-violet-600 w-5 h-5 rounded-full flex items-center justify-center border-2 border-white">
                        <span class="text-[9px] text-white font-bold">1</span>
                    </div>
                </div>
            </div>

            <div class="shrink-0 mt-2">
                <h1 class="text-2xl font-romantic text-violet-700 leading-tight">Para Mi Macita Hermosa üë∏</h1>
                <p class="text-violet-400 text-[10px] uppercase tracking-[0.2em] font-extrabold italic">Nuestra historia de amor</p>
            </div>

            <div id="timer" class="grid grid-cols-3 gap-y-6 gap-x-4 my-5 justify-items-center shrink-0">
                <div class="flip-card-container" id="years-container"></div>
                <div class="flip-card-container" id="months-container"></div>
                <div class="flip-card-container" id="days-container"></div>
                <div class="flip-card-container" id="hours-container"></div>
                <div class="flip-card-container" id="minutes-container"></div>
                <div class="flip-card-container" id="seconds-container"></div>
            </div>

            <div class="space-y-1 mb-4 shrink-0">
                <p class="text-gray-700 font-semibold text-base">Cada d√≠a a tu lado es un regalo.</p>
                <p class="text-violet-600 font-bold text-lg">¬øQuieres ser mi San Valent√≠n?</p>
            </div>

            <div id="button-zone" class="flex flex-col gap-3 items-center justify-center min-h-[140px] relative shrink-0">
                <button id="btnSi" onclick="celebrar()" class="btn-clock-style pulse-btn px-12 z-20 text-base w-full max-w-[240px]">
                    ¬°S√ç, ACEPTO! üíñ
                </button>
                <button id="btnNo" onmouseover="huir()" onclick="huir()" ontouchstart="huir(event)" class="btn-clock-style px-12 z-20 text-base w-full max-w-[240px]">
                    No... ü•∫
                </button>
            </div>
        </div>
    </main>

    <div id="modal" class="hidden fixed inset-0 bg-violet-900/95 backdrop-blur-lg z-[1000] flex items-center justify-center p-6 text-center animate-in fade-in duration-700">
        <div class="bg-white rounded-[40px] p-8 max-w-xs shadow-2xl relative">
            <div class="text-6xl mb-4 animate-bounce">ü•≥</div>
            <h2 class="text-3xl font-romantic text-violet-700 mb-2">¬°Eres incre√≠ble!</h2>
            <p id="modal-message" class="text-gray-600 mb-8 leading-relaxed text-sm"></p>
            <button onclick="enviarWhatsApp()" class="bg-green-500 hover:bg-green-600 text-white font-black py-4 px-10 rounded-full shadow-2xl w-full flex items-center justify-center gap-2 transform active:scale-90 transition">
                <span class="text-sm uppercase tracking-wider">Enviar confirmaci√≥n</span>
            </button>
        </div>
    </div>

    <script>
        const CONFIG = {
            nombreNovia: "Mi Macita Hermosa üë∏", 
            fechaAniversario: [2019, 2, 16], 
            tuWhatsApp: "5491159676723",
            mensajeAceptacion: "¬°S√ç! Acepto ser tu San Valent√≠n! mi pacito precioso y hermoso ‚ù§Ô∏è Te amo",
            /* EDITA AQU√ç TU M√öSICA */
            musicaURL: "https://drive.google.com/uc?export=download&id=1pYRlw-DpIy0V1cSG-4bmGRwI1L8ZL3Gc", 
            fotos: [
                "https://i.postimg.cc/m2GNmvDH/20190511-203652.jpg",
                "https://i.postimg.cc/sDgWvs02/Screenshot-20260211-121155-Gallery.jpg",
                "https://i.postimg.cc/m2g9tB6D/Screenshot-20260211-121212-Gallery.jpg",
                "https://i.postimg.cc/50mH2RBx/20190310-013600.jpg",
                "https://i.postimg.cc/fLMLpfG4/20210212-171324.jpg",
                "https://i.postimg.cc/3R3RVFsH/20210905-201822.jpg",
                "https://i.postimg.cc/V6z6pWxP/20211107-135933.jpg",
                "https://i.postimg.cc/DZ7ZHP9k/20211229-142339.jpg",
                "https://i.postimg.cc/Cxjw0fH1/LRM-EXPORT-525299696851087-20190709-210201020-01.jpg",
                "https://i.postimg.cc/k5s963HC/20211003-141708.jpg"
            ],
            iconos: [
                `<svg width="30" height="45" viewBox="0 0 40 100"><path d="M15 100 L25 100 L22 10 L20 0 L18 10 Z" fill="#E2E8F0" stroke="#94A3B8" stroke-width="2"/></svg>`, 
                `<svg width="22" height="35" viewBox="0 0 40 80"><rect x="10" y="20" width="20" height="50" rx="5" fill="#FB923C"/><rect x="14" y="10" width="12" height="10" fill="#FDBA74"/><rect x="10" y="35" width="20" height="15" fill="#F97316"/><circle cx="20" cy="42" r="4" fill="white" opacity="0.6"/></svg>`,
                `<svg width="30" height="30" viewBox="0 0 50 50"><path d="M5 25 Q25 5 45 25 Z" fill="#FDE047"/><rect x="5" y="25" width="40" height="5" fill="#4ADE80"/><rect x="5" y="30" width="40" height="8" rx="2" fill="#92400E"/><path d="M5 38 Q25 45 45 38 Z" fill="#FDE047"/></svg>`,
                `<svg width="30" height="30" viewBox="0 0 50 50"><path d="M10 20 Q25 10 40 20 L40 35 Q25 45 10 35 Z" fill="#7F1D1D"/><path d="M15 22 L35 22 M15 28 L35 28 M15 34 L35 34" stroke="#B91C1C" stroke-width="2"/></svg>`
            ]
        };

        const audio = document.getElementById('background-music');
        audio.src = CONFIG.musicaURL;

        const units = [
            { id: 'years', label: 'A√±os' }, { id: 'months', label: 'Meses' }, { id: 'days', label: 'D√≠as' },
            { id: 'hours', label: 'Horas' }, { id: 'minutes', label: 'Min' }, { id: 'seconds', label: 'Seg' }
        ];

        units.forEach(u => {
            const container = document.getElementById(u.id + '-container');
            container.innerHTML = `
                <div class="flip-unit">
                    <div class="half top"><div class="num">0</div></div>
                    <div class="half bottom"><div class="num">0</div></div>
                    <div class="leaf"><div class="leaf-front"><div class="num">0</div></div><div class="leaf-back"><div class="num">0</div></div></div>
                    <div class="hinge hinge-left"></div><div class="hinge hinge-right"></div>
                </div>
                <span class="flip-label">${u.label}</span>`;
        });

        document.getElementById('modal-message').innerText = "uuuuff menos mal dijiste que si ü•≥. Te amo mucho, " + CONFIG.nombreNovia + ".";
        const fechaInicio = new Date(CONFIG.fechaAniversario[0], CONFIG.fechaAniversario[1], CONFIG.fechaAniversario[2]);
        let prevValues = { years: -1, months: -1, days: -1, hours: -1, minutes: -1, seconds: -1 };

        function updateFlip(unit, newValue) {
            if (newValue === prevValues[unit]) return;
            const container = document.getElementById(unit + '-container');
            const oldValue = prevValues[unit] === -1 ? newValue : prevValues[unit];
            const leaf = container.querySelector('.leaf');
            const topNum = container.querySelector('.top .num');
            const bottomNum = container.querySelector('.bottom .num');
            const leafFrontNum = container.querySelector('.leaf-front .num');
            const leafBackNum = container.querySelector('.leaf-back .num');

            topNum.innerText = newValue;
            bottomNum.innerText = oldValue;
            leafFrontNum.innerText = oldValue;
            leafBackNum.innerText = newValue;

            if (prevValues[unit] !== -1) {
                leaf.classList.remove('flipping');
                void leaf.offsetWidth; 
                leaf.classList.add('flipping');
                setTimeout(() => {
                    leaf.classList.remove('flipping');
                    bottomNum.innerText = newValue;
                    leafFrontNum.innerText = newValue;
                }, 600);
            } else {
                bottomNum.innerText = newValue;
                leafFrontNum.innerText = newValue;
            }
            prevValues[unit] = newValue;
        }

        function render() {
            const ahora = new Date();
            const diff = ahora - fechaInicio;
            const msPorSec = 1000, msPorMin = 60000, msPorHr = 3600000, msPorDay = 86400000, msPorYear = 31557600000;
            updateFlip('years', Math.floor(diff / msPorYear));
            updateFlip('months', Math.floor((diff % msPorYear) / (msPorSec * 60 * 60 * 24 * 30.44)));
            updateFlip('days', Math.floor((diff % (msPorSec * 60 * 60 * 24 * 30.44)) / msPorDay));
            updateFlip('hours', Math.floor((diff % msPorDay) / msPorHr));
            updateFlip('minutes', Math.floor((diff % msPorHr) / msPorMin));
            updateFlip('seconds', Math.floor((diff % msPorMin) / msPorSec));
        }
        // L√≥gica de sincronizaci√≥n exacta (L√≠nea 370 en tu captura)
        function syncClock() {
            render();
            const now = new Date();
            const timeUntilNextSecond = 1000 - now.getMilliseconds();
            setTimeout(syncClock, timeUntilNextSecond);
        }
        syncClock();

        function huir() {
            const btn = document.getElementById('btnNo');
            const range = 80;
            btn.style.transform = `translate(${(Math.random()-0.5)*range*2}px, ${(Math.random()-0.5)*range}px)`;
        }

        function celebrar() {
            const giftWrapper = document.getElementById('gift-wrapper');
            const giftEmoji = document.getElementById('gift-emoji');
            const giftBadge = document.getElementById('gift-badge');

            // 1. M√∫sica (Carga y reproducci√≥n forzada)
            audio.load();
            audio.play().catch(() => {
                setTimeout(() => audio.play(), 100);
            });

            // 2. Animaci√≥n de Transici√≥n (LO QUE FALTABA)
            giftBadge.style.display = 'none'; 
            giftWrapper.classList.add('gift-container-animate');
            
            // Abre el regalo a los 1.8 segundos
            setTimeout(() => {
                giftEmoji.innerText = "‚ú®"; // Cambia el regalo por brillo
                giftWrapper.classList.add('gift-explode');
            }, 1800);

            // Muestra todo el contenido final a los 3 segundos
            setTimeout(() => {
                document.getElementById('modal').classList.remove('hidden');
                for(let i=0; i<40; i++) setTimeout(crearParticula, i*80);
                for(let j=0; j<25; j++) setTimeout(crearFotoFlotante, j*350);
                giftWrapper.style.display = 'none';
            }, 3000);
        }

        function enviarWhatsApp() {
            window.location.href = `https://wa.me/${CONFIG.tuWhatsApp}?text=${encodeURIComponent(CONFIG.mensajeAceptacion)}`;
        }

        function crearParticula() {
            const container = document.getElementById('particles-container');
            const p = document.createElement('div');
            p.classList.add('particle');
            p.innerHTML = CONFIG.iconos[Math.floor(Math.random()*CONFIG.iconos.length)];
            const dur = Math.random()*3+4;
            p.style.left = Math.random()*100+'vw';
            p.style.transform = `scale(${Math.random()*0.3+0.5})`;
            p.style.animationDuration = dur+'s';
            container.appendChild(p);
            setTimeout(() => p.remove(), dur*1000);
        }

        function crearFotoFlotante() {
            const layer = document.getElementById('photo-layer');
            const photo = document.createElement('div');
            photo.classList.add('photo-particle');
            const size = Math.min(window.innerWidth * 0.35, 130);
            const imgUrl = CONFIG.fotos[Math.floor(Math.random()*CONFIG.fotos.length)];
            photo.innerHTML = `<img src="${imgUrl}" style="width:${size}px;height:${size}px;object-fit:cover;display:block;">`;
            const dur = Math.random()*4+6;
            photo.style.left = (Math.random()*70+10)+'vw';
            photo.style.transform = `rotate(${(Math.random()-0.5)*40}deg)`;
            photo.style.animationDuration = dur+'s';
            layer.appendChild(photo);
            setTimeout(() => photo.remove(), dur*1000);
        }

        setInterval(crearParticula, 1500);
    </script>
</body>
</html>
